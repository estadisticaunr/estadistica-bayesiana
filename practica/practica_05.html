<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="es" xml:lang="es"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.4.549">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">


<title>Estad√≠stica Bayesiana - Pr√°ctica - Unidad 5</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
/* CSS for citations */
div.csl-bib-body { }
div.csl-entry {
  clear: both;
  margin-bottom: 0em;
}
.hanging-indent div.csl-entry {
  margin-left:2em;
  text-indent:-2em;
}
div.csl-left-margin {
  min-width:2em;
  float:left;
}
div.csl-right-inline {
  margin-left:2em;
  padding-left:1em;
}
div.csl-indent {
  margin-left: 2em;
}</style>


<script src="../site_libs/quarto-nav/quarto-nav.js"></script>
<script src="../site_libs/clipboard/clipboard.min.js"></script>
<script src="../site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="../site_libs/quarto-search/fuse.min.js"></script>
<script src="../site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="../">
<link href="../practica/practica_04.html" rel="prev">
<link href="../utils/imgs/favicon.png" rel="icon" type="image/png">
<script src="../site_libs/quarto-html/quarto.js"></script>
<script src="../site_libs/quarto-html/popper.min.js"></script>
<script src="../site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="../site_libs/quarto-html/anchor.min.js"></script>
<link href="../site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="../site_libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="../site_libs/bootstrap/bootstrap.min.js"></script>
<link href="../site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="../site_libs/bootstrap/bootstrap.min.css" rel="stylesheet" id="quarto-bootstrap" data-mode="light">
<script id="quarto-search-options" type="application/json">{
  "location": "navbar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "end",
  "type": "overlay",
  "limit": 50,
  "keyboard-shortcut": [
    "f",
    "/",
    "s"
  ],
  "show-item-context": false,
  "language": {
    "search-no-results-text": "Sin resultados",
    "search-matching-documents-text": "documentos encontrados",
    "search-copy-link-title": "Copiar el enlace en la b√∫squeda",
    "search-hide-matches-text": "Ocultar resultados adicionales",
    "search-more-match-text": "resultado adicional en este documento",
    "search-more-matches-text": "resultados adicionales en este documento",
    "search-clear-button-title": "Borrar",
    "search-text-placeholder": "",
    "search-detached-cancel-button-title": "Cancelar",
    "search-submit-button-title": "Enviar",
    "search-label": "Buscar"
  }
}</script>

  <script src="https://polyfill.io/v3/polyfill.min.js?features=es6"></script>
  <script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-chtml-full.js" type="text/javascript"></script>

<script type="text/javascript">
const typesetMath = (el) => {
  if (window.MathJax) {
    // MathJax Typeset
    window.MathJax.typeset([el]);
  } else if (window.katex) {
    // KaTeX Render
    var mathElements = el.getElementsByClassName("math");
    var macros = [];
    for (var i = 0; i < mathElements.length; i++) {
      var texText = mathElements[i].firstChild;
      if (mathElements[i].tagName == "SPAN") {
        window.katex.render(texText.data, mathElements[i], {
          displayMode: mathElements[i].classList.contains('display'),
          throwOnError: false,
          macros: macros,
          fleqn: false
        });
      }
    }
  }
}
window.Quarto = {
  typesetMath
};
</script>

</head>

<body class="nav-sidebar docked nav-fixed">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
    <nav class="navbar navbar-expand-lg " data-bs-theme="dark">
      <div class="navbar-container container-fluid">
      <div class="navbar-brand-container mx-auto">
    <a class="navbar-brand" href="../index.html">
    <span class="navbar-title">Estad√≠stica Bayesiana</span>
    </a>
  </div>
            <div id="quarto-search" class="" title="Buscar"></div>
          <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarCollapse" aria-controls="navbarCollapse" aria-expanded="false" aria-label="Navegaci√≥n de palanca" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
  <span class="navbar-toggler-icon"></span>
</button>
          <div class="collapse navbar-collapse" id="navbarCollapse">
            <ul class="navbar-nav navbar-nav-scroll ms-auto">
  <li class="nav-item">
    <a class="nav-link" href="../info/programa.html"> 
<span class="menu-text">Informaci√≥n</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="../teoria/u1_teoria_01.html"> 
<span class="menu-text">Teor√≠a</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link active" href="../practica/practica_00.html" aria-current="page"> 
<span class="menu-text">Pr√°ctica</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="../trabajos_practicos/descripcion.html"> 
<span class="menu-text">Trabajos Pr√°cticos</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="../recursos/codigo/index.html"> 
<span class="menu-text">Recursos</span></a>
  </li>  
  <li class="nav-item compact">
    <a class="nav-link" href="https://github.com/estadisticaunr/estadistica-bayesiana"> <i class="bi bi-github" role="img">
</i> 
<span class="menu-text"></span></a>
  </li>  
</ul>
          </div> <!-- /navcollapse -->
          <div class="quarto-navbar-tools">
</div>
      </div> <!-- /container-fluid -->
    </nav>
  <nav class="quarto-secondary-nav">
    <div class="container-fluid d-flex">
      <button type="button" class="quarto-btn-toggle btn" data-bs-toggle="collapse" data-bs-target=".quarto-sidebar-collapse-item" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Alternar barra lateral" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
        <i class="bi bi-layout-text-sidebar-reverse"></i>
      </button>
        <nav class="quarto-page-breadcrumbs" aria-label="breadcrumb"><ol class="breadcrumb"><li class="breadcrumb-item"><a href="../practica/practica_05.html">Unidad 5</a></li></ol></nav>
        <a class="flex-grow-1" role="button" data-bs-toggle="collapse" data-bs-target=".quarto-sidebar-collapse-item" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Alternar barra lateral" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">      
        </a>
    </div>
  </nav>
</header>
<!-- content -->
<div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article page-navbar">
<!-- sidebar -->
  <nav id="quarto-sidebar" class="sidebar collapse collapse-horizontal quarto-sidebar-collapse-item sidebar-navigation docked overflow-auto"><div class="quarto-sidebar-header"><div class="sidebar-header-item">
<p>Pr√°ctica</p>
</div></div>
    <div class="sidebar-menu-container"> 
    <ul class="list-unstyled mt-1">
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../practica/practica_00.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Unidad 0</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../practica/practica_01.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Unidad 1</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../practica/practica_02.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Unidad 2</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../practica/practica_03.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Unidad 3</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../practica/practica_04.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Unidad 4</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../practica/practica_05.html" class="sidebar-item-text sidebar-link active">
 <span class="menu-text">Unidad 5</span></a>
  </div>
</li>
    </ul>
    </div>
</nav>
<div id="quarto-sidebar-glass" class="quarto-sidebar-collapse-item" data-bs-toggle="collapse" data-bs-target=".quarto-sidebar-collapse-item"></div>
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
    <div class="quarto-alternate-formats"><h2>Otros formatos</h2><ul><li><a href="practica_05.pdf"><i class="bi bi-file-pdf"></i>PDF</a></li></ul></div></div>
<!-- main -->
<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<h1 class="title">Pr√°ctica - Unidad 5</h1>
</div>



<div class="quarto-title-meta">

    
  
    
  </div>
  


</header>


<section id="modelos-de-regresi√≥n-avanzados" class="level2">
<h2 class="anchored" data-anchor-id="modelos-de-regresi√≥n-avanzados">Modelos de regresi√≥n avanzados</h2>
<p>En esta √∫ltima unidad de la pr√°ctica se presentan ejercicios que requieren el desarrollo de modelos de regresi√≥n con un nivdel de complejidad mayor. La distribuci√≥n condicional de la respuesta ya no es necesariamente normal y la forma del predictor de la media incluye caracter√≠sticas que lo diferencian de un predictor lineal simple. Adem√°s, esta unidad presenta ejercicios con modelos jer√°rquicos.</p>
<ol type="1">
<li><p>üìå <strong>Regresi√≥n Poisson</strong></p>
<p>Considere el siguiente modelo para datos de conteo con un predictor <span class="math inline">\(X\)</span> que toma valores entre -3 y 50:</p>
<p><span class="math display">\[
\begin{aligned}
Y_i   &amp;\sim \mathrm{Poisson}(\lambda_i) \\
\log(\lambda_i) &amp;= \beta X \\
\end{aligned}
\]</span></p>
<ol type="i">
<li>Genere 1000 valores de <span class="math inline">\(X\)</span>, asuma un valor conocido (y fijo) para <span class="math inline">\(\beta\)</span>, simule los correspondientes valores de <span class="math inline">\(\lambda_i\)</span> y los de <span class="math inline">\(Y_i\)</span>. ¬øC√≥mo es <span class="math inline">\(\lambda\)</span> en funci√≥n de <span class="math inline">\(X\)</span>? ¬øEs lineal la relaci√≥n entre <span class="math inline">\(X\)</span> e <span class="math inline">\(Y\)</span>? ¬øQu√© ocurre con la varianza de <span class="math inline">\(Y\)</span> en funci√≥n de <span class="math inline">\(X\)</span>? ¬øC√≥mo es la distribuci√≥n marginal de <span class="math inline">\(Y\)</span>?</li>
<li>Ahora a√±ada incertidumbre al valor de <span class="math inline">\(\beta\)</span> (¬øc√≥mo se hace esto?) y simule nuevamente valores para <span class="math inline">\(\lambda_i\)</span> y <span class="math inline">\(Y_i\)</span>. Compare los resultados.</li>
</ol></li>
<li><p>üìå <strong>Regresi√≥n log√≠stica</strong></p>
<p>Considere el siguiente modelo de clasificaci√≥n con un predictor <span class="math inline">\(X\)</span> que toma valores entre -30 y 10:</p>
<p><span class="math display">\[
\begin{aligned}
Y_i   &amp;\sim \mathrm{Bernoulli}(\theta_i) \\
\log\left(\frac{\theta_i}{1 - \theta_i}\right) &amp;= \beta X \\
\end{aligned}
\]</span></p>
<ol type="i">
<li>Genere 1000 valores de <span class="math inline">\(X\)</span>, asuma un valor conocido (y fijo) para <span class="math inline">\(\beta\)</span>, simule los correspondientes valores de <span class="math inline">\(\theta_i\)</span> y los de <span class="math inline">\(Y_i\)</span>. ¬øC√≥mo es <span class="math inline">\(\theta\)</span> en funci√≥n de <span class="math inline">\(X\)</span>? ¬øEs lineal la relaci√≥n entre <span class="math inline">\(X\)</span> e <span class="math inline">\(Y\)</span>?</li>
<li>Ahora a√±ada incertidumbre al valor de <span class="math inline">\(\beta\)</span> (¬øc√≥mo se hace esto?) y simule nuevamente valores para <span class="math inline">\(\theta_i\)</span> y <span class="math inline">\(Y_i\)</span>. Compare los resultados.</li>
</ol></li>
<li><p>üìå <strong>Intenci√≥n de voto</strong></p>
<p>El conjunto de datos <code>elecciones.csv</code> contiene los resultados de un estudio piloto sobre intenci√≥n de voto. Contiene las variables <code>voto</code>, <code>edad</code> y <code>partido</code> que indican respectivamente el candidato elegido, la edad y la afinidad partidaria del encuestado.</p>
<p>Utilice un modelo de regresi√≥n log√≠stica para responder a las siguiente preguntas de investigaci√≥n:</p>
<ol type="1">
<li>¬øC√≥mo se relaciona la edad de los encuestados con la intenci√≥n de voto?</li>
<li>¬øEs esta relaci√≥n diferente para las diferentes afinidades partidarias?</li>
</ol></li>
<li><p>üìå <strong>D√≠as de ausencia</strong></p>
<p>Un organismo p√∫blico de un Estado de los Estados Unidos est√° intereaso en estudiar el comportamiento de la asistencia de los estudiantes de secundaria. Para eso se cuenta con datos de 314 estudiantes tercer a√±o en <code>students.csv</code>. Los predictores del n√∫mero de d√≠as de ausencia incluyen el tipo de programa en el que est√° inscrito el estudiante y una prueba estandarizada de matem√°ticas.</p>
<p>Las variables de inter√©s en el conjunto de datos son:</p>
<ul>
<li><code>daysabs</code>: El n√∫mero de d√≠as de ausencia. Es nuestra variable de respuesta.</li>
<li><code>progr</code>: El tipo de programa. Puede ser uno de los siguientes: <code>"General"</code>, <code>"Academic"</code> o <code>"Vocational"</code>.</li>
<li><code>math</code>: Puntuaci√≥n en una prueba de matem√°ticas estandarizada.</li>
</ul>
<p>Interesa evaluar la asociaci√≥n entre el tipo de programa y la puntuaci√≥n en la prueba con los d√≠as de ausencia. Tambi√©n se desea ver ver si la asociaci√≥n entre el puntaje en la prueba y los d√≠as de ausencia es diferente en cada tipo de programa.</p>
<p>Realice un an√°lisis exploratorio de los datos y elabore un modelo de regresi√≥n Poisson que permita explicar la asociaci√≥n entre las variables predictoras y la cantidad de d√≠as que se ausentan los estudiantes.</p></li>
<li><p>üìå <strong><em>Baseball</em></strong></p>
<p>El b√©isbol es uno de los deportes donde se m√°s intensivamente se utilizan herramientas estad√≠sticas y anal√≠ticas. La cantidad de m√©tricas que se calculan para los jugadores es muy elevada. Supongamos que estamos en un equipo de b√©isbol y nos gustar√≠a <strong>cuantificar el rendimiento de los jugadores</strong>, siendo una de las m√©tricas su promedio de bateo (definido por la cantidad de veces que un bateador golpea una pelota lanzada, dividido por el n√∫mero de veces que se presenta al bate) ¬øC√≥mo podr√≠amos utilizar la estad√≠stica bayesiana para resolver este problema?</p>
<p>La tabla <code>batting</code> es una compilaci√≥n de datos hist√≥ricos de b√©isbol realizada por el <em>Baseball Databank</em>. Entre otras, contiene las siguientes columnas de inter√©s:</p>
<ul>
<li><code>playerID</code>: Identificaci√≥n del jugador</li>
<li><code>AB</code>: Cantidad de veces que el jugador se presenta al bate</li>
<li><code>H</code>: Cantidad de veces que el jugador golpea la pelota al batear</li>
<li><code>batting_avg</code>: El cociente entre <code>H</code> y <code>AB</code></li>
</ul>
<p>Proponga un modelo de regresi√≥n log√≠stica para estimar la probabilidad de bateo para cada jugador. Incorpore la identificaci√≥n del jugador en el modelo. Considere primero un modelo no jer√°rquico y luego un modelo jer√°rquico.</p></li>
<li><p>üìå <strong>Privados del sue√±o</strong></p>
<p>El conjunto de datos <code>sleepstudy</code> contiene el tiempo de reacci√≥n promedio en una serie de pruebas para un grupo de participantes en un estudio de privaci√≥n del sue√±o. Los primeros dos d√≠as del estudio se consideran de adaptaci√≥n y entrenamiento, el tercer d√≠a es una l√≠nea de base y la privaci√≥n del sue√±o comienza despu√©s del d√≠a 3. Los sujetos de este grupo estaban restringidos a 3 horas de sue√±o por noche. El objetivo era analizar c√≥mo la falta de sue√±o afectaba la capacidad de respuesta y la precisi√≥n en dicha tarea.</p>
<p>La variable de respuesta es <code>"Reaction"</code>, que representa el promedio de las mediciones de tiempo de reacci√≥n de los participantes en un d√≠a determinado (en milisegundos). Las dos covariables son <code>"Days"</code>, que indica el n√∫mero de d√≠as de privaci√≥n del sue√±o, y <code>"Subject"</code>, que es el identificador del participante sobre el cual se realiz√≥ la medici√≥n.</p>
<p>Se propone utilizar un modelo de regresi√≥n lineal de la forma:</p>
<p><span class="math display">\[
\begin{aligned}
\text{Reaction}_i &amp; \sim \text{Normal}(\mu_i, \sigma) \\
\mu_i &amp; = \beta_0 + \beta_1\text{Days}_i \\
\end{aligned}
\]</span></p>
<p>Considerando a los sujetos como grupos, eval√∫e las siguientes alternativas para estimar el intercepto y la pendiente:</p>
<ul>
<li><em>Complete pooling</em></li>
<li><em>No pooling</em></li>
<li><em>Partial pooling</em></li>
</ul></li>
<li><p>üìå <strong>Modelo lineal para elecciones en Estados Unidos</strong></p>
<p>Utilice el conjunto de datos de las elecciones presidenciales de Estados Unidos del a√±o 2016 que se provee en <span class="citation" data-cites="Reich2020">Reich y Ghosh (<a href="#ref-Reich2020" role="doc-biblioref">2019</a>)</span> (<code>rep_2012_2016</code>). Elabore un modelo de regresi√≥n lineal bayesiano donde la variable respuesta es la diferencia porcentual entre el porcentaje de votos que obtuvo el candidato Republicano en el 2016 versus los que tuvo en el 2012 en cada condado y utilice todas las dem√°s variables como predictoras.</p>
<ol type="i">
<li>Utilice distribuciones <em>a priori</em> normales no informativas. Interprete las distribuciones <em>a posteriori</em> marginales de los coeficientes de regresi√≥n.</li>
<li>Calcule los residuos <span class="math inline">\(\boldsymbol{r} = \boldsymbol{y} - \boldsymbol{X}\hat{\boldsymbol{\beta}}\)</span> donde <span class="math inline">\(\hat{\boldsymbol{\beta}}\)</span> es la media a posteriori del vector de coeficientes de regresi√≥n ¬øPuede concluir que los residuos siguen una distribuci√≥n normal? ¬øQu√© condados presentan los residuos m√°s grandes y m√°s peque√±os? ¬øQu√© puede indicar sobre estos condados? <!-- 4.6.3 @Reich2020 sin efectos aleatorios --></li>
</ol></li>
<li><p><strong>Control de armas</strong></p>
<p>Utilice el conjunto de datos sobre el control de armas en Estados Unidos. Estos datos provienen de un estudio transversal. Para el estado <span class="math inline">\(i\)</span>, sea <span class="math inline">\(Y_i\)</span> el numero de homicidios y <span class="math inline">\(N_i\)</span> el tama√±o de la poblaci√≥n.</p>
<ol type="i">
<li>Ajuste el modelo <span class="math inline">\(Y_i \mid \boldsymbol{\beta} \sim \text{Poisson}(N_i\lambda_i)\)</span> donde <span class="math inline">\(\text{log}(\lambda_i) = \boldsymbol{X}_i\boldsymbol{\beta}\)</span>. Use distribuciones <em>a priori</em> no informativas y <span class="math inline">\(p = 7\)</span> de las covariables en <span class="math inline">\(\boldsymbol{X}_i\)</span>: el intercepto, los cinco <em>confounders</em> <span class="math inline">\(\boldsymbol{Z}_i\)</span>, y el n√∫mero de leyes relacionadas a armas. Justifique que el <em>sampler</em> ha convergido y explorado suficientemente la distribuci√≥n a posteriori y resuma la distribuci√≥n a posteriori de <span class="math inline">\(\boldsymbol{\beta}\)</span>. <!--
i. To Do: No puse los puntos (b) y (c) porque no se si estan dentro del plan
i. To Do: Ver como presentamos el tema de las variables a incorporar en el modelo
--></li>
</ol></li>
<li><p>üß© <strong>¬øA cu√°ntas Sof√≠as conoces?</strong></p>
<p>Descargue el conjunto de datos <code>babynames</code> en <code>R</code> y calcule el log-odds de un beb√© llamado ‚ÄúSophia‚Äù en cada a√±o luego de 1950.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb1"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(babynames)</span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a>dat <span class="ot">&lt;-</span> babynames</span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a>dat <span class="ot">&lt;-</span> dat[dat<span class="sc">$</span>name <span class="sc">==</span> <span class="st">"Sophia"</span> <span class="sc">&amp;</span> dat<span class="sc">$</span>sex <span class="sc">==</span> <span class="st">"F"</span> <span class="sc">&amp;</span> dat<span class="sc">$</span>year <span class="sc">&gt;</span> <span class="dv">1950</span>, ]</span>
<span id="cb1-4"><a href="#cb1-4" aria-hidden="true" tabindex="-1"></a>yr <span class="ot">&lt;-</span> dat<span class="sc">$</span>year</span>
<span id="cb1-5"><a href="#cb1-5" aria-hidden="true" tabindex="-1"></a>p <span class="ot">&lt;-</span> dat<span class="sc">$</span>prop</span>
<span id="cb1-6"><a href="#cb1-6" aria-hidden="true" tabindex="-1"></a>t <span class="ot">&lt;-</span> dat<span class="sc">$</span>year <span class="sc">-</span> <span class="dv">1950</span></span>
<span id="cb1-7"><a href="#cb1-7" aria-hidden="true" tabindex="-1"></a>Y <span class="ot">&lt;-</span> <span class="fu">log</span>(p <span class="sc">/</span> (<span class="dv">1</span> <span class="sc">-</span> p))</span></code><button title="Copiar al portapapeles" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Sea <span class="math inline">\(Y_t\)</span> el log-odds muestral en el a√±o <span class="math inline">\(t + 1950\)</span>. Ajuste el siguiente modelo auto-regresivo de orden 1:</p>
<p><span class="math display">\[
\begin{aligned}
Y_t   &amp;= \mu_t + \rho(Y_{t - 1} + \mu_{t - 1}) + \varepsilon_t \\
\mu_t &amp;= \alpha + \beta t \\
\varepsilon &amp;\underset{iid}{\sim} \text{Normal}(0, \sigma^2) \\
\alpha, \beta &amp;\sim \text{Normal}(0, 100^2) \\
\rho &amp;\sim \text{Uniforme}(-1, 1) \\
\sigma^2 &amp;\sim \text{InvGamma}(0.1, 0.1)
\end{aligned}
\]</span></p>
<ol type="i">
<li>Interprete los par√°metros del modelo (<span class="math inline">\(\alpha\)</span>, <span class="math inline">\(\beta\)</span>, <span class="math inline">\(\rho\)</span> y <span class="math inline">\(\sigma^2\)</span>)</li>
<li>Ajuste el modelo utilizando <code>{RStan}</code> para <span class="math inline">\(t &gt; 1\)</span>. Verifique la convergencia y reporte la media a posteriori e intervalos del 95% para los par√°metros.</li>
<li>Grafique la distribuci√≥n predictiva a posteriori para <span class="math inline">\(Y_t\)</span> en el a√±o 2020. <!-- @Reich2020 --></li>
</ol></li>
<li><p>üß© <strong>Meta-an√°lisis</strong></p>
<p>En este ejercicio se llevar√° a cabo un meta-an√°lisis, es decir, un an√°lisis que combina el resultado de varios estudios. Los datos provienen del paquete <code>{rmeta}</code> en <code>R</code>.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb2"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(rmeta)</span>
<span id="cb2-2"><a href="#cb2-2" aria-hidden="true" tabindex="-1"></a><span class="fu">data</span>(cochrane)</span>
<span id="cb2-3"><a href="#cb2-3" aria-hidden="true" tabindex="-1"></a>cochrane</span></code><button title="Copiar al portapapeles" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<pre><code>          name ev.trt n.trt ev.ctrl n.ctrl
1     Auckland     36   532      60    538
2        Block      1    69       5     61
3        Doran      4    81      11     63
4        Gamsu     14   131      20    137
5     Morrison      3    67       7     59
6 Papageorgiou      1    71       7     75
7      Tauesch      8    56      10     71</code></pre>
<p>Los datos provienen de siete ensayos aleatorizados que eval√∫an el efecto de la terapia con corticosteroides en la muerte neonatal. Para el ensayo <span class="math inline">\(i \in \{1, \dots, 7 \}\)</span> <span class="math inline">\(Y_{i0}\)</span> representa el n√∫mero de eventos que ocurren en el grupo de control de tama√±o <span class="math inline">\(N_{i0}\)</span> y <span class="math inline">\(Y_{i1}\)</span> representa el n√∫mero de eventos que ocurren en el grupo tratado de tama√±o <span class="math inline">\(N_{i1}\)</span>.</p>
<ol type="i">
<li>Ajuste el modelo <span class="math inline">\(Y_{ij} \mid \theta_j \underset{indep}{\sim} \text{Binomial}(N_{ij}, \theta_j)\)</span> con <span class="math inline">\(\theta_0, \theta_1 \sim \text{Uniforme}(0, 1)\)</span>. ¬øSe puede concluir que el tratamiento est√° asociado a una reducci√≥n de la tasa de muerte?</li>
<li>Ajuste el modelo <span class="math inline">\(Y_{ij} \mid \theta_j \underset{indep}{\sim} \text{Binomial}(N_{ij}, \theta_j)\)</span> con
<ul>
<li><span class="math inline">\(\text{logit}(\theta_{ij}) = \alpha_{ij}\)</span></li>
<li><span class="math inline">\(\boldsymbol{\alpha}_i = (\alpha_{i0}, \alpha_{i1})^T \underset{iid}{\sim} \text{Normal}(\boldsymbol{\mu}, \boldsymbol{\Sigma})\)</span></li>
<li><span class="math inline">\(\boldsymbol{\mu} \sim \text{Normal}(0, 10^2I_2)\)</span></li>
<li><span class="math inline">\(\boldsymbol{\Sigma} \sim \text{InvWishart}(3, I_2)\)</span></li>
</ul>
Interprete los resultados indicando si estos sugieren que el tratamiento est√° asociado a una reducci√≥n en la tasa de muerte.</li>
<li>Dibuje un DAG para ambos modelos.</li>
<li>Discuta las ventajas y desventajas de ambos modelos.</li>
<li>¬øCu√°l modelo es el preferido para estos datos? <!-- @Reich2020 --></li>
</ol></li>
<li><p><strong>Comparando modelos normales</strong></p>
<p>Utilice el conjuto de datos <code>airquality</code> que viene con el paquete <code>{datasets}</code> que se carga autom√°ticamente al crear una sesi√≥n de <code>R</code>.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb4"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb4-1"><a href="#cb4-1" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(airquality)</span></code><button title="Copiar al portapapeles" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<pre><code>  Ozone Solar.R Wind Temp Month Day
1    41     190  7.4   67     5   1
2    36     118  8.0   72     5   2
3    12     149 12.6   74     5   3
4    18     313 11.5   62     5   4
5    NA      NA 14.3   56     5   5
6    28      NA 14.9   66     5   6</code></pre>
<p>Compare los siguientes modelos utilizando <em>5-fold cross-validation</em>:</p>
<p><span class="math display">\[
\begin{array}{l}
\mathcal{M}_1: \text{Ozone}_i \sim \text{Normal}(\beta_1 + \beta_2 \text{Solar.R}_i, \sigma^2) \\
\mathcal{M}_2: \text{Ozone}_i \sim \text{Normal}(\beta_1 + \beta_2 \text{Solar.R}_i + \beta_3 \text{Temp}_i + \beta_4 \text{Wind}_i, \sigma^2)
\end{array}
\]</span></p>
<p>Elija <em>priors</em> para los par√°metros de ambos modelos explicando su elecci√≥n. <!-- @Reich2020 --></p></li>
</ol>
<!-- 1.  **Accidente del Challenger**

    NO ESTAN REDACTADAS LAS CONSIGNAS

    El 28 de enero de 1986, el vuelo n√∫mero veinticinco del programa estadounidense de 
    trasbordadores espaciales acab√≥ en un desastre cuando uno de los propulsores del 
    Challenger explot√≥ poco despu√©s del despegue. En el accidente murieron los siete 
    tripulantes. La comisi√≥n que investig√≥ el accidente concluy√≥ que el accidente fue 
    causado por una falla en un _o-ring_ en una juntura de uno de los propulsores. 
    Esta falla se debi√≥ a un dise√±o defectuoso que volvi√≥ al _o-ring_ excesivamente 
    sensible a factores externos, entre ellos la temperatura. De los veinticuatro vuelos
    previos, exist√≠a informaci√≥n de fallas de _o-rings_ para veintitr√©s de ellos 
    (el otro se perdi√≥ en el oc√©ano). Estos datos fueron discutidos la noche previa al 
    incidente. No obstante, los datos de los siete vuelos en los que hubo fallas llevaron 
    a la conclusi√≥n de que no hab√≠a una evidencia clara. 
    
    @DavidsonPilon2015



    ::: {.cell}
    ::: {.cell-output-display}
    
    
    |   |   |   |   |   |   |   |   |   |   |   |   |   |   |   |   |   |   |   |   |   |   |   |   |
    |:--|--:|--:|--:|--:|--:|--:|--:|--:|--:|--:|--:|--:|--:|--:|--:|--:|--:|--:|--:|--:|--:|--:|--:|
    |T  | 66| 70| 69| 68| 67| 72| 73| 70| 57| 63| 70| 78| 67| 53| 67| 75| 70| 81| 76| 79| 75| 76| 58|
    |F  |  0|  1|  0|  0|  0|  0|  0|  0|  1|  1|  1|  0|  0|  1|  0|  0|  0|  0|  0|  0|  1|  0|  1|
    
    
    :::
    :::


-->
<ol type="1">
<li><p>üß© <strong>Curvas de crecimiento de tiranos√°uridos</strong></p>
<p>Se analizan datos de 20 f√≥siles de tiranos√°uridos para estimar las curvas de crecimiento de cuatro especies: Albertosaurio, Daspletosaurio, Gorgosaurio y Tiranosaurio. Los datos se toman de la Tabla 1 de <span class="citation" data-cites="Erickson2004">Erickson et&nbsp;al. (<a href="#ref-Erickson2004" role="doc-biblioref">2004</a>)</span> y se muestran en la <a href="#fig-dinos" class="quarto-xref">Figura&nbsp;1</a>. El objetivo es determinar la curva de crecimiento, esto es, determinar el peso esperado por edad para todas las especies.</p>
<p>En el panel izquierdo de la <a href="#fig-dinos" class="quarto-xref">Figura&nbsp;1</a> se puede observar que hay una relaci√≥n no lineal entre la edad y el peso. Tambi√©n se observan ciertos patrones comunes a las especies. Por ejemplo, la relaci√≥n positiva entre las variables o el decrecimiento en la tasa de cambio conforme la edad es mayor.</p>
<div class="cell">
<div class="cell-output-display">
<div id="fig-dinos" class="quarto-figure quarto-figure-center quarto-float anchored">
<figure class="quarto-float quarto-float-fig figure">
<div aria-describedby="fig-dinos-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<img src="practica_05_files/figure-html/fig-dinos-1.png" class="img-fluid figure-img" width="864">
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-dinos-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figura&nbsp;1: (Izquierda) Edad (a√±os) vs Peso (kilogramos). (Derecha) Los mismos datos luego de aplicar la transformaci√≥n logar√≠tmica a ambas variables.
</figcaption>
</figure>
</div>
</div>
</div>
<p>Sea <span class="math inline">\(Y_{ij}\)</span> el peso y <span class="math inline">\(X_{ij}\)</span> y la edad de la muestra <span class="math inline">\(i\)</span> de la especie <span class="math inline">\(j\)</span>, con <span class="math inline">\(j = 1, 2, 3, 4\)</span>. Se propone el siguiente modelo:</p>
<p><span class="math display">\[
Y_{ij} = f_j(X_{ij}) \epsilon_{ij}
\]</span></p>
<p>donde <span class="math inline">\(f_j\)</span> es la verdadera curva de crecimiento para la especie <span class="math inline">\(j\)</span> y <span class="math inline">\(\epsilon_{ij} &gt; 0\)</span> es un error multiplicativo.</p>
<ol type="i">
<li>¬øPor qu√© tiene sentido proponer un error multiplicativo?</li>
<li>¬øCu√°l es un valor sensato para la media de la distribuci√≥n del error?</li>
<li>Utilice una distribuci√≥n log-normal para el error, <span class="math inline">\(\log (\epsilon_{ij}) \sim \text{Normal}\)</span>. Proponga valores para la media y la varianza de forma tal que satisfagan la condici√≥n del punto anterior.</li>
</ol>
<p>Esto da lugar un al siguiente modelo log-normal para <span class="math inline">\(Y_{ij}\)</span>:</p>
<p><span class="math display">\[
\log (Y_{ij}) \sim \text{Normal}
(\log [f_j(X_{ij})] + \mu_{\log \epsilon}, \sigma^2_{\log \epsilon})
\]</span></p>
<p>con <span class="math inline">\(\mathbb{E}(Y_{ij}) = f_j(X_{ij})\)</span>.</p>
<p>A continuaci√≥n se proponen cuatro modelos que var√≠an seg√∫n la relaci√≥n funcional que se propone para <span class="math inline">\(f_j\)</span> y la naturaleza de las distribuciones a priori que se utilizan.</p>
<p><strong>Modelo 1</strong></p>
<p>Observando el panel derecho de la <a href="#fig-dinos" class="quarto-xref">Figura&nbsp;1</a> se puede concluir que luego de transformar ambas variables con la funci√≥n logaritmo la relaci√≥n se ve aproximadamente lineal. Por lo tanto, se propone el siguiente modelo log-lineal:</p>
<p><span class="math display">\[
\log [f_j(X)] = a_j + b_j \log(X)
\]</span></p>
<p>donde <span class="math inline">\(a_j\)</span> y <span class="math inline">\(b_j\)</span> representan al intercepto y pendiente de la especie <span class="math inline">\(j\)</span>. La curva de crecimiento en la escala original resulta <span class="math inline">\(f_j(X) = \exp (a_j)X^{b_j}\)</span>. Considere los siguientes <em>priors</em>:</p>
<p><span class="math display">\[
\begin{aligned}
a_j &amp;\sim \text{Normal}(0, 10) \\
b_j &amp;\sim \text{Normal}(0, 10) \\
\sigma^2_j &amp;\sim \text{InvGamma}(0.1, 0.1)
\end{aligned}
\]</span></p>
<ol type="i">
<li>Escriba un programa en Stan que implemente el modelo y obtenga el posterior con <code>{RStan}</code>.</li>
<li>Analice los coeficientes del modelo y las curvas de crecimiento. Realice gr√°ficos que permitan observar la curva ajustada y su incertidumbre para cada especie.</li>
</ol>
<p><strong>Modelo 2</strong></p>
<p>Este modelo es el mismo que el <strong>Modelo 1</strong>, excepto que las especies tienen la misma varianza, <span class="math inline">\(\sigma^2_j = \sigma^2\)</span> y los coeficientes de regresi√≥n son modelados de manera jer√°rquica. Utilice los siguientes <em>priors</em>:</p>
<p><span class="math display">\[
\begin{aligned}
\mu_a    &amp;\sim \text{Normal}(0, 10) \\
\sigma_a &amp;\sim \text{InvGamma}(0.1, 0.1) \\
\mu_b    &amp;\sim \text{Normal}(0, 10) \\
\sigma_b &amp;\sim \text{InvGamma}(0.1, 0.1) \\
a_j      &amp;\sim \text{Normal}(\mu_a, \sigma^2_a) \\
b_j      &amp;\sim \text{Normal}(\mu_b, \sigma^2_b) \\
\sigma^2 &amp;\sim \text{InvGamma}(0.1, 0.1)
\end{aligned}
\]</span></p>
<ol type="i">
<li>Escriba un programa en Stan que implemente el modelo y obtenga el posterior con <code>{RStan}</code>.</li>
<li>Analice los coeficientes del modelo y las curvas de crecimiento. Genere gr√°ficos similares a los producidos en el punto anterior. Describa similitudes y diferencias respecto del modelo 1. Justifique su respuesta.</li>
<li>¬øQu√© problemas detecta los modelos 1 y 2? Considere como evoluciona el peso conforme la edad seg√∫n el modelo.</li>
</ol>
<p><strong>Modelo 3</strong></p>
<p>Como alternativa al componente log-lineal anterior, se propone la siguiente curva de crecimiento log√≠stico:</p>
<p><span class="math display">\[
f_j(X) = a_j + b_j \frac{\exp [d_j (\log(X) - c_j)]}{1 + \exp [d_j(\log(X) - c_j)]}
\]</span></p>
<p>Este modelo tiene cuatro par√°metros:</p>
<ul>
<li><span class="math inline">\(a_j\)</span> es el peso esperado cuando la edad es 0;</li>
<li><span class="math inline">\(b_j\)</span> es el peso m√°ximo esperado (o la cota superior del peso);</li>
<li><span class="math inline">\(\log (c_j)\)</span> es la edad a la que la especie <span class="math inline">\(j\)</span> alcanza la mitad del peso m√°ximo;</li>
<li><span class="math inline">\(d_j &gt; 0\)</span> determina la tasa de crecimiento del peso conforme aumenta la edad.</li>
</ul>
<p>Para que la curva sea positiva y creciente para todas las edades, se debe cumplir que <span class="math inline">\(a_j &gt; 0\)</span>, <span class="math inline">\(b_j &gt; a_j\)</span> y <span class="math inline">\(d_j &gt; 0\)</span>. Se pueden satisfacer estas restricciones expresando los par√°metros en funci√≥n de par√°metros cuyo dominio es <span class="math inline">\(\mathbb{R}\)</span>:</p>
<ul>
<li><span class="math inline">\(a_j = \exp (\alpha_{j1})\)</span>;</li>
<li><span class="math inline">\(b_j = \exp (\alpha_{j2})\)</span>;</li>
<li><span class="math inline">\(c_j = \alpha_{j3}\)</span>;</li>
<li><span class="math inline">\(d_j = \exp (\alpha_{j4})\)</span>.</li>
</ul>
<p>Considere las siguientes distribuciones <em>a priori</em> para los par√°metros del modelo:</p>
<p><span class="math display">\[
\begin{aligned}
\alpha_{jk} &amp;\sim \text{Normal}(0, 10) \\
\sigma^2_j  &amp;\sim \text{InvGamma}(0.1, 0.1)
\end{aligned}
\]</span></p>
<ol type="i">
<li>Escriba un programa en Stan que implemente el modelo y obtenga el posterior con <code>{RStan}</code>.</li>
<li>Analice los diagn√≥sticos de la inferencia realizada.</li>
<li>Grafique las curvas estimadas para cada especie junto a sus intervalos de credibilidad e interprete los resultados.</li>
</ol>
<p><strong>Modelo 4</strong></p>
<p>Este modelo es el mismo que el <strong>Modelo 3</strong>, excepto que las especies tienen la misma varianza, <span class="math inline">\(\sigma^2_j = \sigma^2\)</span> y los coeficientes de regresi√≥n son modelados de manera jer√°rquica. Utilice los siguientes <em>priors</em>:</p>
<p><span class="math display">\[
\begin{aligned}
\mu_k             &amp;\sim \text{Normal}(0, 10) \\
\sigma^2_k        &amp;\sim \text{InvGamma}(0.1, 0.1) \\
\log(\alpha_{jk}) &amp;\sim \text{Normal}(\mu_k, \sigma^2_k) \\
\sigma^2          &amp;\sim \text{InvGamma}(0.1, 0.1)
\end{aligned}
\]</span></p>
<ol type="i">
<li>Escriba un programa en Stan que implemente el modelo y obtenga el posterior con <code>{RStan}</code>.</li>
<li>Analice los diagn√≥sticos de la inferencia y compare con los resultados del modelo 3.</li>
<li>Grafique las curvas estimadas para cada especie junto a sus intervalos de credibilidad e interprete los resultados. Compare con los resultados del modelo 3. ¬øQu√© diferencias observa? ¬øPor qu√© se dan?</li>
<li>Escriba una s√≠ntesis comparando todos los modelos desarrollados. Comente ventajas y desventajas de cada uno de ellos, explicando a que se deben en cada caso ¬øQu√© modelo resulta m√°s conveniente para estimar la curva de crecimiento de los tiranos√°uridos? Justifique su respuesta.</li>
</ol>
<!--
**Nota:** Queremos usar los priors del libro? O mejor usamos otra cosa?
Estoy mirando los InvGamma por ejemplo. √çdem con la notaci√≥n de varianza vs desv√≠o 
est√°ndar.
-->
<!-- https://www4.stat.ncsu.edu/~bjreich/BSMdata/T_rex.html --></li>
</ol>



</section>

<div id="quarto-appendix" class="default"><section class="quarto-appendix-contents" role="doc-bibliography" id="quarto-bibliography"><h2 class="anchored quarto-appendix-heading">Referencias</h2><div id="refs" class="references csl-bib-body hanging-indent" data-entry-spacing="0" role="list">
<div id="ref-DavidsonPilon2015" class="csl-entry" role="listitem">
Davidson-Pilon, Cameron. 2015. <em>Bayesian Methods for Hackers: Probabilistic Programming and Bayesian Inference</em>. 1st edition. Addison-Wesley Data; Analytics Series.
</div>
<div id="ref-Erickson2004" class="csl-entry" role="listitem">
Erickson, Gregory M, Peter J Makovicky, Philip J Currie, Mark A Norell, Scott A Yerby, y Christopher A Brochu. 2004. <span>¬´Gigantism and comparative life-history parameters of tyrannosaurid dinosaurs¬ª</span>. <em>Nature</em> 430: 772-75.
</div>
<div id="ref-Reich2020" class="csl-entry" role="listitem">
Reich, Brian J., y Sujit K. Ghosh. 2019. <em>Bayesian Statistical Methods</em>. 1st edition. Chapman; Hall/CRC.
</div>
</div></section></div></main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "Óßã";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button', {
    text: function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
    }
  });
  clipboard.on('success', function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copiado");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copiado");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  });
  function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
    const config = {
      allowHTML: true,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start',
    };
    if (contentFn) {
      config.content = contentFn;
    }
    if (onTriggerFn) {
      config.onTrigger = onTriggerFn;
    }
    if (onUntriggerFn) {
      config.onUntrigger = onUntriggerFn;
    }
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      return note.innerHTML;
    });
  }
  const xrefs = window.document.querySelectorAll('a.quarto-xref');
  const processXRef = (id, note) => {
    // Strip column container classes
    const stripColumnClz = (el) => {
      el.classList.remove("page-full", "page-columns");
      if (el.children) {
        for (const child of el.children) {
          stripColumnClz(child);
        }
      }
    }
    stripColumnClz(note)
    if (id === null || id.startsWith('sec-')) {
      // Special case sections, only their first couple elements
      const container = document.createElement("div");
      if (note.children && note.children.length > 2) {
        container.appendChild(note.children[0].cloneNode(true));
        for (let i = 1; i < note.children.length; i++) {
          const child = note.children[i];
          if (child.tagName === "P" && child.innerText === "") {
            continue;
          } else {
            container.appendChild(child.cloneNode(true));
            break;
          }
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(container);
        }
        return container.innerHTML
      } else {
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        return note.innerHTML;
      }
    } else {
      // Remove any anchor links if they are present
      const anchorLink = note.querySelector('a.anchorjs-link');
      if (anchorLink) {
        anchorLink.remove();
      }
      if (window.Quarto?.typesetMath) {
        window.Quarto.typesetMath(note);
      }
      // TODO in 1.5, we should make sure this works without a callout special case
      if (note.classList.contains("callout")) {
        return note.outerHTML;
      } else {
        return note.innerHTML;
      }
    }
  }
  for (var i=0; i<xrefs.length; i++) {
    const xref = xrefs[i];
    tippyHover(xref, undefined, function(instance) {
      instance.disable();
      let url = xref.getAttribute('href');
      let hash = undefined; 
      if (url.startsWith('#')) {
        hash = url;
      } else {
        try { hash = new URL(url).hash; } catch {}
      }
      if (hash) {
        const id = hash.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note !== null) {
          try {
            const html = processXRef(id, note.cloneNode(true));
            instance.setContent(html);
          } finally {
            instance.enable();
            instance.show();
          }
        } else {
          // See if we can fetch this
          fetch(url.split('#')[0])
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.getElementById(id);
            if (note !== null) {
              const html = processXRef(id, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      } else {
        // See if we can fetch a full url (with no hash to target)
        // This is a special case and we should probably do some content thinning / targeting
        fetch(url)
        .then(res => res.text())
        .then(html => {
          const parser = new DOMParser();
          const htmlDoc = parser.parseFromString(html, "text/html");
          const note = htmlDoc.querySelector('main.content');
          if (note !== null) {
            // This should only happen for chapter cross references
            // (since there is no id in the URL)
            // remove the first header
            if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
              note.children[0].remove();
            }
            const html = processXRef(null, note);
            instance.setContent(html);
          } 
        }).finally(() => {
          instance.enable();
          instance.show();
        });
      }
    }, function(instance) {
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            div.style.left = 0;
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
        // Handle positioning of the toggle
    window.addEventListener(
      "resize",
      throttle(() => {
        elRect = undefined;
        if (selectedAnnoteEl) {
          selectCodeLines(selectedAnnoteEl);
        }
      }, 10)
    );
    function throttle(fn, ms) {
    let throttle = false;
    let timer;
      return (...args) => {
        if(!throttle) { // first call gets through
            fn.apply(this, args);
            throttle = true;
        } else { // all the others get throttled
            if(timer) clearTimeout(timer); // cancel #2
            timer = setTimeout(() => {
              fn.apply(this, args);
              timer = throttle = false;
            }, ms);
        }
      };
    }
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
<nav class="page-navigation">
  <div class="nav-page nav-page-previous">
      <a href="../practica/practica_04.html" class="pagination-link  aria-label=" unidad="" 4"="">
        <i class="bi bi-arrow-left-short"></i> <span class="nav-page-text">Unidad 4</span>
      </a>          
  </div>
  <div class="nav-page nav-page-next">
  </div>
</nav>
</div> <!-- /content -->
<footer class="footer">
  <div class="nav-footer">
    <div class="nav-footer-left">
      &nbsp;
    </div>   
    <div class="nav-footer-center">
      &nbsp;
    </div>
    <div class="nav-footer-right">
<p>Esta p√°gina es hecha con ‚ù§Ô∏è y <a href="https://quarto.org/">Quarto</a>.</p>
</div>
  </div>
</footer>




</body></html>