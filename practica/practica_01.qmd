---
title: "Pr치ctica - Unidad 1"
bibliography: ../references.bib
nocite: |
  @Johnson2021, @McElreath2020, @Martin2021, @Hoff2009
pdf_file: https://github.com/estadisticaunr/estadistica-bayesiana/raw/pdf/practica/practica_01.pdf
---

```{r echo=FALSE, include=FALSE}
is_html <- knitr::is_html_output()
options("knitr.graphics.error" = FALSE)
source(here::here("scripts", "utils.R"))
caption_data <- list(
    "bebe_panda" = list(author = "Stone Wang", handle = "stonewyq", code = "0wk7m5SVPsM"),
    "colectivo" = list(author = "Markus Winkler", handle = "markuswinkler", code = "HII6PEEvLHw")
)
captions <- lapply(caption_data, function(x) do.call(make_unsplash_caption, x))
captions[["crepusculo"]] <- "Robert Pattinson como Edward en Crep칰sculo"
captions[["ceibo"]] <- "Flor del Ceibo, la flor nacional"
```

::: {.content-visible when-format="html"}

[Descargar PDF]({{< meta pdf_file >}})

:::

## Regla de Bayes

1. Escribir la expresi칩n matem치tica para cada una de las siguientes descripciones verbales:
    a. Probabilidad de un parametro dados los datos observados
    a. La distribucion de probabilidad de los parametros antes de ver los datos
    a. La verosimilitud de los datos para un valor dado de los par치metros
    a. La probabilidad de una observaci칩n nueva dados los datos observados
    a. La probabilidad de una observaci칩n  antes de ver los datos
    a. **To Do** Revisar texto. No se si es mejor usar "dado/dada" o "condicional a", 
    u otra expresi칩n.
    a. **To Do** Algunas descripciones no estan cubiertas en la **Unidad 1**.
    <!-- @Martin2021 -->

1. El test ~~in~~falible

    En una poblaci칩n dada, una de cada mil personas tiene una enfermedad. 
    Se toma una persona al azar de la poblaci칩n, se le aplica un test para detectar dicha enfermedad, y el resultado es positivo.
    El test se caracteriza por dar positivo el 99% de las veces que una persona tiene la enfermedad. 
    Adem치s, dicho test tiene una tasa de falsos positivos del 5%.

    * 쮺u치l es la probabilidad de que la persona tenga efectivamente la enfermedad?
    * Si realizamos el mismo an치lisis una segunda vez sobre el mismo paciente y obtenemos nuevamente positivo 
        * 쮺u치l seria la probabilidad que el paciente est칠 enfermo? 
        * 쯏 si diera negativo?
        * 쮼s el a priori el mismo para el segundo an치lisis que para el primero?
    <!-- @Martin2021 -->

1.  쮼s verdad que existen los vampiros? Versi칩n Crep칰sculo

    Edward quiere probarle a Bella que los vampiros existen.
    Seg칰n Bella, hay una probabilidad del 5% de que los vampiros existan.
    Tambi칠n cree que la probabilidad de que exista alguien con la piel brillante
    dado que los vampiros existen es del 70%, y que la probabilidad de que alguien tenga 
    la piel brillante si los vampiros no existen es del 3%.
    Edward lleva a Bella al bosque y le muestra que de hecho su piel brilla como un 游눑
    쮺u치l es la probabilidad que existan los vampiros?
    <!-- @Johnson2021 -->

    ```{r, echo=FALSE, out.width="70%", fig.align="center", fig.cap=captions[["crepusculo"]]}
    if (is_html) knitr::include_graphics(file.path("imgs", "crepusculo.jpg"))
    ```

1.  Los M&Ms azul fueron introducidos en el a침o 1995 
    ([antes hab칤a dos tipos de marr칩n](http://content.time.com/time/specials/packages/article/0,28804,2011482_2011480_2011460,00.html))

    * Antes de 1995, la mezcla de colores en una bolsa de M&Ms era: 30% marron, 20% amarillo, 20% rojo, 10% verde, 10% naranja y 10% marr칩n *bronceado*.
    * Luego de 1995, la mezcla pas칩 a ser: 24% azul, 20% verde, 16% naranja, 14% amarillo, 13% rojo y 13% marr칩n.

    Un amigo tiene dos bolsas de M&M y nos dice que una bolsa es de 1994 y la otra es de 1996, pero no nos dice cu치l es cu치l. Nos da un M&M de cada bolsa: uno es amarillo y el otro es verde (ambos posiblemente est칠n vencidos). 쮺u치l es la probabilidad de que el amarillo venga de la bolsa de 1994?

1.  츼rboles enfermos

    Un vivero de la ciudad se destaca por vender una variedad de 치rboles nativos,
    incluyendo al jacarand치, ceibo, omb칰, entre otros.
    Lamentablemente, el 18% de los 치rboles del vivero estan infectados con moho.
    Los 치rboles enfremos se componen en un 15% por jacarand치s, 80% de ceibos, y 5% de otras especies.
    Los 치rboles sanos se componen por un 20% de jacarand치s, 10% de ceibos, y 70% de otras especies.
    Con el objetivo de monitorear cuanto se propag칩 la enfermedad, uno de los empleados 
    del vivero selecciona al azar uno de los 치rboles para testear.

    * 쮺u치l es la probabilidad a priori de que el 치rbolo tenga moho?
    * Resulta que el 치rbol seleccionado es un ceibo. 쮺u치l es la probabilidad de haber 
    seleccionado un ceibo?
    * 쮺u치l es la probabilidad a posteriori de que el ceibo seleccionado tenga moho?
    * Compare las probabilidades a priori y a posteriori de que el 치rbol tenga moho. 
    쮺칩mo afecta el an치lisis el saber que el 치rbol es un ceibo?
    <!-- @Johnson2021 -->

    ```{r, echo=FALSE, out.width="70%", fig.align="center", fig.cap=captions[["ceibo"]]}
    if (is_html) knitr::include_graphics(file.path("imgs", "ceibo.png"))
    ```

1.  Transporte El Impuntual

    Una cierta empresa de transporte regional, que decidimos llamar "El Impuntual",
    tiene servicios que van desde Rosario hasta Wheelwright varias veces al d칤a, todos
    los d칤as de la semana. Un 30% de los viajes salen a la ma침ana, otro 30% salen a la tarde,
    y el restante 40% salen a la noche. Los pasajeros suelen estar muy frustrados
    ya que un 25% de los viajes salen tarde^[Algunos dicen que "cada dos por tres" te deja a pata. 
    No nos vamos a pelear explic치ndoles que estan siendo demasiado malos, ya que un 25% 
    tambi칠n es un mont칩n!]. De estos viajes demorados, el 40% corresponden a la ma침ana, un
    50% suceden a la tarde, y el 10% restante ocurre a la noche. 
    
    Lucio y Franco son dos amigos del pueblo, y se volvieron a sus casas en colectivos diferentes. 

    * Lucio se fue en uno de los colectivos de la ma침ana. 
    쮺u치l es la probabilidad que su viaje est칠 demorado?
    * El colectivo de Franco no est치 demorado. 
    쮺u치l es la probabilidad de que est칠 viajando en uno de los colectivos de la ma침ana?
    <!-- @Johnson2021 -->
    
    ```{r, echo=FALSE, out.width="70%", fig.align="center", fig.cap=captions[["colectivo"]]}
    if (is_html) knitr::include_graphics(file.path("imgs", "colectivo.jpg"))
    ```

1.  Beb칠 panda

    Supongamos que hay dos especies de osos panda. 
    Ambas especies son igual de frecuentes y viven en la misma regi칩n. 
    Es m치s, lucen de la misma forma y comen la misma comida. 
    A칰n no existe una prueba gen칠tica que pueda diferenciarlos. 
    Lo 칰nico que los diferencia es la cantidad de cr칤as que suelen tener.
    Las madres de la especie A dan luz a mellizos el 10% del tiempo.
    Y las madres de la especie B dan a luz mellizos el 20% del tiempo.
    En todos los otros casos, estas madres dan a luz un solo beb칠 panda.

    Usando un poco la imaginaci칩n, 
    supongamos que somos la persona encargada de un programa de reproducci칩n de pandas.
    Tenemos una panda femenina que acaba de dar a luz a un par de mellizos, 
    pero no sabemos a que especie pertenece.

    * 쮺u치l es la probabilidad que la mam치 panda sea de la especie A?
    * 쮺u치l es la probabilidad que vuelva a tener mellizos en la pr칩xima parici칩n?
    * Un tiempo despu칠s sos encontramos con que en la segunda parici칩n da a luz a un 칰nico
    beb칠 panda. 쮺u치l es la probabilidad de que este panda sea de la especie A?
    <!-- @McElreath2020 -->

    ```{r, echo=FALSE, out.width="70%", fig.align="center", fig.cap=captions[["bebe_panda"]]}
    if (is_html) knitr::include_graphics(file.path("imgs", "bebe_panda.jpg"))
    ```

1.  Demuestra la validez de la siguiente expresi칩n de la regla de Bayes

    $$
    P(B_j | A) = \frac{P(A | B_j) P(B_j)}{\sum_{k=1}^{K}P(A | B_k) P(B_k)}
    $$

    donde $A$ es un evento cualquiera y $\{B_1, \cdots, B_K\}$ forman una partici칩n.
    Para ello siga los siguientes pasos

    i. Demuestre que $P(B_j | A) P(A) = P(A | B_j) P(B_j)$.
    i. Demuestre que $P(A) = P(A \cap B_1) + P(A \cap \{\cup_{k=2}^{K}B_j\})$.
    i. Demuestre que $P(A) = \sum_{k=1}^{K} P(A \cap B_j)$.
    i. Junte las partes para formar la regla de Bayes.
    <!-- @Hoff2009 -->
    <!-- Se necesitan los axiomas P1-P3 del capitulo 2. -->

## Popurr칤?

Todos como que caen dentro de "regla de bayes". Tenemos que ver como los dividimos

1.  Sea $X_1 \sim \text{Bernoulli}(\theta)$ una variable que indica si una especie de 
    치rboles se halla en un determinado bosque y $\theta \in [0, 1]$ representa la 
    probabilidad _a priori_ de que la especie se encuentre en el bosque. 
    Una investigadora selecciona una muestra de $n$ 치rboles del bosque y encuentra que 
    $X_2$ de ellas pertenecen a la especie de inter칠s.  

    El modelo luego es
    $$
    \begin{array}{lc}
    X_2|X_1 \sim \text{Binomial}(n, \lambda X_1) & \text{con } \lambda \in [0, 1]
    \end{array}
    $$

    $\lambda$ representa la probabilidad de detectar la especie, dado que la especie se
    encuentra en el bosque. 

    Encuntre expresiones matem치ticas en t칠rmino de $n$, $\theta$ y $\lambda$ 
    para las siguientes probabilidades:

    i. $P(X_1 = 0, X_2 = 0)$
    i. $P(X_1 = 0)$
    i. $P(X_2 = 0)$
    i. $P(X_1 = 0 | X_2 = 0)$
    i. $P(X_2 = 0 | X_1 = 0)$
    i. $P(X_1 = 0 | X_2 = 1)$
    i. $P(X_2 = 0 | X_1 = 1)$
    i. Explique de manera intuitiva c칩mo es que las probabilidades calculadas en (iv)-(vii)
    cambian seg칰n $n$, $\theta$ y $\lambda$.
    i. Asuma $\theta=0.5$, $\lambda=0.1$ y $X_2 = 0$ 쮺u치n grande debe ser $n$ para que 
    se puede concluir con 95% de confianza que la especie no se encuentra en el bosque?
    <!-- @Reich2020 -->

1.  En un estudio que utiliza m칠todos de la Estad칤stica Bayesiana para predecir el n칰mero
    de especies que ser치n descubiertas en el futuro se reporta que la cantidad de especies
    marinas bivalvas^[Una clase de molusco. El mejill칩n, la ostra y la almeja son bivalvos]
    descubiertas cada a침o entre 2010 y 2015 fue 64, 13, 33, 18, 30 y 20.  
    Si se representa con $Y_t$ a la cantidad de especies descubierta en el a침o $t$, y 
    asumiendo:
    
    $$
    \begin{aligned}
    Y_t | \lambda &\underset{iid}{\sim} \text{Poisson}(\lambda) \\
    \lambda       &\sim \text{Uniforme}(0, 100)
    \end{aligned}
    $$  

    Graficar la distribuci칩n a posteriori de $\lambda$.
    <!-- @Reich2020 -->

1.  Sea $n$ la cantidad desconocida de clientes que visitan una tienda en un dia cualquiera.
    El n칰mero de clientes que realizan una compra es $Y$ y se cumple que 

    $$
    Y | n \sim \text{Binomial}(n, \theta)
    $$

    donde $\theta$ es la probabilidad de compra, dado que se produce la visita a la tienda.
    La distribuci칩n _a priori_ de $n$ es $n \sim \text{Poisson}(5)$. 
    Bajo el supuesto que $\theta$ es conocido y que $n$ es desconocido, 
    graficar la distribuci칩n _a posteriori_ de $n$ para todas las combinaciones de 
    $Y \in \{0, 5, 10 \}$ y $\theta \in \{0.2, 0.5\}$. Explique cual es del efecto de 
    cambiar $Y$ y $\theta$ sobre la distribuci칩n _a posteriori_.  
    <!-- Me parece interesante porque plantea la inferencia sobre "n" en vez de "p" -->
    <!-- @Reich2020 -->

## Conceptuales

1.  Voy a conseguir esa pasant칤a

    La empresa de tecnolog칤a en la que todo el mundo quiere trabajar tiene varias vacantes
    para pasantes en ciencia de datos. Luego de leer la descripci칩n de la b칰squeda,
    te das cuenta que sos una persona calificada para el puesto: estos son tus **datos**.
    Tu objetivo es averiguar si te van a ofrecer el puesto: esta es tu **hip칩tesis**. 

    i. Desde la perspectiva de una persona con un razonamiento frecuentista, 
    쯈u칠 es lo que se responde al evaluar la hip칩tesis de que te ofrecen el puesto?
    i. Repita el punto anterior considerando la perspectiva de una persona con un 
    razonamiento Bayesiano.
    i. 쯈u칠 pregunta tiene m치s sentido responder: la frecuentista o la Bayesiana? 
    Justifica tu respuesta.
    <!-- @Johnson2021 -->

1.  Beneficios de la Estad칤stica Bayesiana

    Una amiga te cuenta que est치 interesada en aprender m치s sobre Estad칤stica Bayesiana.
    Explica lo siguiente:

    i. 쯇or qu칠 es 칰til el enfoque Bayesiano?
    i. 쮺u치les son las similitudes entre el enfoque frecuentista y el Bayesiano?
    <!-- @Johnson2021 -->


<!-- 1.  Me gusta mucho el ejercicio 1.1 de @Johnson2021 pero creo que es muy yankee-c칠ntrico. 
    Habr칤a que buscar uno que hable de una historia que sea mas familiar en nuestro 
    contexto. -->


## To Do

* Ejercicios conceptuales
* Sacar likelihood a mano
* Sacar posterior a mano
    * Una discreta
    * Una continua


<!-- * Me parece que algunas preguntas conceptuales podrian estar incluso al final del curso
    * O podriamos volver a hacerlas, a ver como cambian las respuestas
    * Eso permitiria dejarlas aca, pero sacarle presion
* Prefiero el contraste entre "enfoque bayesiano" y "enfoque frecuentista" que 
"estadistica bayesiana" y "estadistica frecuentista". Creo que hay una sola "estadistica"
y hay muchisimos principios que son comunes. Luego varia el "enfoque" con el cual se mira
a los parametros y el proceso generador de datos. En otras palabras, puedo expresar el mismo
modelo estadistico pero encararlo desde distinto enfoque. El modelo sigue siendo el mismo,
lo que cambia es el enfoque con el que lo miro, y en consecuencia, el significado de 
algunas partes.     
* Tambien me parece que "frecuentista" vs "bayesiano" es una simplificacion que mete
dentro de frecuentista a muchas cosas que no son exactamente lo mismo, hay
unos trabajos de Bradley Efron que ayudan (ver abajo)

Hay un par de trabajos/comentarios criticos que me parecen interesantes y creo que 
la materia deberia tenerlos en cuenta
https://www2.stat.duke.edu/courses/Spring10/sta122/Handouts/EfronWhyEveryone.pdf
https://www.jstor.org/stable/27590513
https://www.colorado.edu/amath/sites/default/files/attached-files/efron.pdf
https://twitter.com/dan_p_simpson/status/1564579319758073856
https://math.stackexchange.com/a/2079842
https://www.ime.usp.br/~abe/lista/pdfxeAKkfZxJM.pdf
http://www.math.chalmers.se/Stat/Grundutb/GU/MSA220/S16/Efron250years.pdf
Computer Age Statistical Inference:
    * Los capitulos 2, 3, y 4 tratan 
    "Frequentist Inference", "Bayesian Inference", 
    y "Fisherian Inference and Maximum Likelihood Estimation"
-->